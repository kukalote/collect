# HTTPS (SSL/STL)原理

来源 : http://www.cnblogs.com/digdeep/p/4832885.html
来源 : http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html
来源 : http://www.guokr.com/post/114121/
来源 : http://www.cnblogs.com/digdeep/p/4833856.html

###  必要的加密解密基础知识

1. 对称加密算法：就是加密和解密使用同一个密钥的加密算法。因为加密方和解密方使用的密钥相同，所以称为称为对称加密，也称为单钥加密方法。

	> 优点是：加密和解密运算速度快，所以对称加密算法通常在消息发送方需要加密大量数据时使用；
    缺点是：安全性差，如果一方的密钥遭泄露，那么整个通信就会被破解。另外加密之前双方需要同步密钥;
    常用对称加密算法有：DES、3DES、TDEA、Blowfish、RC2、RC4、RC5、IDEA、SKIPJACK、AES等;

2. 非对称加密算法：而非对称加密算法需要两个密钥来进行加密和解密，这两个秘钥是公开密钥(public key，简称公钥)和私有密钥(private key，简称私钥)。

	> 公钥和私钥是一对：公钥用来加密，私钥解密，而且公钥是公开的，私钥是自己保存的，不需要像对称加密那样在通信之前要先同步秘钥。
    有点是：安全性更好，私钥是自己保存的，不需要像对称加密那样在通信之前要先同步秘钥。
    缺点是：加密和解密花费时间长、速度慢，只适合对少量数据进行加密。
    常用的非对称加密算法有：RSA、Elgamal、Rabin、D-H、ECC等；

3. HASH算法：也称为消息摘要算法。将任意长度的二进制值映射为较短的固定长度的二进制值，该二进制值称为哈希值。

	> 常用于检验数据的完整性，检验数据没有被篡改过。常见的又 MD5(MD系列)，SHA-1(SHA系列)

### HTTPS 的作用

HTTPS简单而言，即使建立在SSL/TLS协议之上的HTTP。不使用SSL/TLS的HTTP通信，就是不加密的通信。所有信息明文传播，带来了三大风险。

    （1） 窃听风险（eavesdropping）：第三方可以获知通信内容。
    （2） 篡改风险（tampering）：第三方可以修改通信内容。
    （3） 冒充风险（pretending）：第三方可以冒充他人身份参与通信。

SSL/TLS协议是为了解决这三大风险而设计的，希望达到：

    （1） 所有信息都是加密传播，第三方无法窃听。
    （2） 具有校验机制，一旦被篡改，通信双方会立刻发现。
    （3） 配备身份证书，防止身份被冒充。

互联网是开放环境，通信双方都是未知身份，这为协议的设计带来了很大的难度。而且，协议还必须能够经受所有匪夷所思的攻击，这使得SSL/TLS协议变得异常复杂。

### HTTPS 的历史

互联网加密通信协议的历史，几乎与互联网一样长。

    1994年，NetScape公司设计了SSL协议（Secure Sockets Layer）的1.0版，但是未发布。
    1995年，NetScape公司发布SSL 2.0版，很快发现有严重漏洞。
    1996年，SSL 3.0版问世，得到大规模应用。
    1999年，互联网标准化组织ISOC接替NetScape公司，发布了SSL的升级版TLS 1.0版。
    2006年和2008年，TLS进行了两次升级，分别为TLS 1.1版和TLS 1.2版。最新的变动是2011年TLS 1.2的修订版。

目前，应用最广泛的是TLS 1.0，接下来是SSL 3.0。但是，主流浏览器都已经实现了TLS 1.2的支持。

TLS 1.0通常被标示为SSL 3.1，TLS 1.1为SSL 3.2，TLS 1.2为SSL 3.3。

### 给网站申请https证书的过程

user, server, CA，这三者是PKI中的三个角色。user方接收到server发出的证书，并通过user自身客户端（浏览器或者其他APP等程序）内含的已信任CA（根证书）列表来做校验，只有证实该server提供的https证书是已信任CA签发的，https通信才可以继续。

所以我们的https证书必须是主流CA签发的才行。为什么强调“主流”？因为不同浏览器使用的已信任CA列表可能是不尽相同的。IE，firefox，chrome，都带有自己的根证书集合。大型电子商务网站必然使用最为知名的CA机构，例如verisign (已被symantec收购）、enTrust等等。

申请证书时候，需要给CA机构提供证书签发申请CSR文件(certificate sigining request)。大部分支持https的web服务程序都可以生成CSR文件。步骤如下：

    1. 根据RSA算法生成公钥私钥对。私钥即需要机密保管的以.key为后缀名的文件，公钥则在.csr文件中。csr文件中还包括生成CSR过程中输入的组织名、域名、联系人邮箱等信息。

    2. 发送CSR文件给证书供应商，比如verisign。供应商对CSR文件做处理，设置有效期限等，并做最为关键的动作：用供应商自己的私钥对证书进行签名。这样就生成了一张有效的SSL证书。

    3. 用户收到证书后，在web服务器（或负载均衡等设备）上，以此前的私钥文件和收到的公钥证书为密钥对，生成SSL配置文件，并绑定到对应的web站点上。

###  HTTPS 的负作用

商业授权：根证书厂商签发中级证书给二级证书厂商（即授权），二级厂商可以签发终端证书给自己的客户。这里面存在安全监管的问题。去年和今年陆续出现了法国信息系统安全局（ANSSI）和中国CNNIC授权的中级证书厂商恶意（自称“无意”）签发了google域名的证书的重大安全事件。

> ANSSI的事件，据其自称是“使用不当，用自己运营的公网CA根证书对内部私网环境签发了google域名的证书给内部测试使用”。但显然这种辩解是站不住脚的。这张证书是否能用在公网上，完全只取决于用哪张CA根证书签发。用了公网CA根证书（即属于浏览器默认配置的根证书集）做签发，则必定可以在公网上使用。只要建立一个钓鱼站点绑定这张舞弊证书，再加上DNS劫持（这个很容易做到），用户的google加密信息全部可以被盗取。真的很怕怕。怪不得微软、谷歌等公司迅速通过各种途径吊销（revoke）了这张舞弊证书。

> CNNIC事件也是类似。其签发了一张中级证书给埃及一家公司，后者违规签发了google.com域名的证书。由于SSL证书链的设计，只要信任了CNNIC根证书的用户，也随之会信任这张埃及公司的舞弊证书。当然了，CNNIC也随之被chrome等浏览器开除了。

    小伙伴们，中级证书的重要性不亚于根证书啊。
