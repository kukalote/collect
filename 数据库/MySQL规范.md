###  一、基础规范

1. 合理使用MyISAM、INNODB存储引擎

2. 表字符集使用`UTF8`

3. 所有表都需要添加注释

4. 单表数据量建议控制在`2000W`以内

5. 不在数据库中存储图⽚、文件等大数据

6. 禁止在数据库做运算,包括数学运算MySQL不擅长数学运算和逻辑判断，如`sum`,`max`等、

7. 平衡范式与冗余，效率优先，往往牺牲范式；

8. 禁止使用外键，触发器、函数、存储过程

9. 尽量避免连表查询，所有数据查询建议主键查询

### 二、命名规范

1. 库名表名字段名必须有固定的命名长度，`12`个字符以内

2. 库名、表名、字段名禁⽌止超过`32`个字符。须见名之意

3. 库名、表名、字段名禁⽌止使⽤用MySQL保留字

4. 临时库、表名必须以`tmp`为前缀，并以⽇日期为后缀

文件:[Http://static.oschina.net/uploads/space/2015/0710/013535 hFDl 568818.jpg](Http://static.oschina.net/uploads/space/2015/0710/013535 hFDl 568818.jpg)

5. 备份库、表必须以`bak`为前缀，并以日期为后缀  

### 三、库、表、字段开发设计规范

1. 禁⽌使用分区表

2. 拆分大字段和访问频率低的字段，分离冷热数据

3. 尽可能不使用`TEXT`、`BLOB`类型，`varchar`的性能会比`text`高很多；实在避免不了`blob`，请拆表；

4. 用`DECIMAL`代替`FLOAT`和`DOUBLE`存储精确浮点数

5. 所有字段均定义为`NOT NULL`，避免使用`NULL`字段 `NULL`字段很难查询优化，`NULL`字段的索引需要额外空间，`NULL`字段的复合索引无效

6. 使用`UNSIGNED`存储非负整数

7. 使用`VARBINARY`存储大小写敏感的变长字符串

8. 禁止在数据库中存储明文密码，把密码加密后存储

9. 用好数值类型字段

        tinyint      (1byte)
        smallint     (2byte)
        mediumint   (3byte)
        int         (4byte)
        bigint       (8byte)
如果数值字段没有那么大，就不要用 `bigint` 

10. 存储ip，建议采用`char(15)`，提高可读性  

### 四、索引规范

1. 索引的数量要控制：

        (1) 单张表中索引数量不超过5个
        (2) 单个索引中的字段数不超过5个
        (3) 对字符串使⽤用前缀索引，前缀索引长度不超过8个字符
        (4) 建议优先考虑前缀索引，必要时可添加伪列并建立索引

2. 主键准则

        (1) 表必须有主键
        (2) 建议选择自增或发号器
        (3) 不选择字符串列作为主键
        (4) 不使用UUID MD5 HASH这些作为主键(数值太离散了)
        (5) 不使用更新频繁的列作为主键
        (6) 如果不指定主键，innodb会使用唯一且非空值索引代替

3. 重要的SQL必须被索引

        如：
        (1) UPDATE、DELETE语句的WHERE条件列
        (2) ORDER BY、GROUP BY、DISTINCT的字段

4. 多表JOIN的字段注意以下：

        (1) 区分度最大的字段放在前面
        (2) 核⼼SQL优先考虑覆盖索引
        (3) 避免冗余和重复索引
        (4) 索引要综合评估数据密度和分布以及考虑查询和更新比例

5. 索引禁忌

        (1) 不在低基数列上建立索引，例如“性别”
        (2) 不在索引列进行数学运算和函数运算

6. 索引命名：非唯一索引必须以 `idx_字段1_字段2命名`，唯一所以必须以`uniq_字段1_字段2命名`，索引名称必须全部小写

7. 反复查看与表相关的SQL，符合最左前缀的特点建立索引。多条字段重复的语句，要修改语句条件字段的顺序，为其建立一条联合索引，减少索引数量

8. 能使用唯一索引就要使用唯一索引，提高查询效率

9. 研发要经常使用`explain`，如果发现索引选择性差，必须让他们学会使用`hint`

### 五、SQL规范

1. sql语句尽可能简单，大的sql想办法拆成小的sql语句充分利用`QUERY CACHE`和充分利用多核CPU、

2. 事务要简单，整个事务的时间长度不要太长

3. 能缓存数据的，建议使用`select *` ,可以一次缓存复用数据，尽量多用memcache,redis缓存。不缓存的不要用`select *`，查询哪几个字段就`select` 这几个字段

4. sql中使用到`OR`的改写为用 `IN`、 `or`的效率没有`in`的效率高、能不用`NOT IN`就不用NOTIN，坑太多了。。会把`空`和`NULL`给查出来

5. `in`里面数字的个数建议控制在`1000`以内

6. `limit`分页注意效率。`Limit`越大，效率越低。可以改写 `limit`，比如例子改写：

        select id from tlimit 10000, 10;  =>  select id from t where id > 10000 limit10;

7. 使用 `union all` 替代 `union`，避免使⽤大表的 `JOIN`

8. 使用 `group by` 分组、自动排序，禁止使⽤ `order by rand`

9. 对数据的更新要打散后批量更新，不要一次更新太多数据，禁⽌单条SQL语句同时更新多个表

10. 注意使用性能分析工具

        Sql explain  /  showprofile   /    mysqlsla

11. 禁止在数据库中跑大查询，数据表数据大时，禁止手动更改表结构，一定要提交到系统部处理

12. 使⽤预编译语句，只传参数，比传递SQL语句更高效；一次解析，多次使用；降低SQL注入概率

### 六、流程规范

1. 大数据表需更改表结构必须提交到系统部DBA同事处理

2. 所有的建表需要确定建立哪些索引后才可以建表上线；

3. 批量导入、导出数据必须提前通知DBA协助处理

4. 禁⽌在线上从库执行后台管理和统计类查询

5. 推广活动或上线新功能必须提前通知DBA进⾏行流量评估

6. 不在业务高峰期批量更新、查询数据库 


