### Linux 文件权限解析

### 6 理解 Linux 文件权限

- [文件权限符号](#文件权限符号)
- [默认文件权限](#默认文件权限)
- [共享文件](#共享文件)
- [修改用户默认组](#chgrp)
- [修改所有者](#chown) 


#### [文件权限符号](id:文件权限符号)

    $ ls -l
    drwxrewxr-x 2 rich rich 4096 2007-09-03 15:12 test
    
输出清单中的第一个字段是描述文件和目录的权限的代码。字段中的第一个字符定义了对象的类型 : 

- `-` : 普通文件
- `d` : 目录
- `c` : 字符设备
- `b` : 块设备
- `l` : 符号链接
- `s` : 套接字
- `p` : 管道
- `n` 表示网络设备

在它后面是 3 组字符。每组的 3 个字符都定义一个访问权限 : 

- `r` 表示对象读取权限;
- `w` 表示对象写权限;
- `x` 表示对象执行权限。

如果拒绝了某个权限, 则该位置会出现一个破折号。这 3 组字符分别与 3 种级别的对象安全性相关 :   

- 对象的所有者;
- 拥有对象的用户组;
- 系统上的其他任何人。 

[返回目录](#toc)

#### [默认文件权限](id:默认文件权限)

`umask` 命令为您创建的任何文件或目录设置默认权限。  

`umask` 命令显示并设置默认权限 : 

    $ umask
    0022
    
**Linux 文件权限代码**  

权限 | 二进制 | 八进制 | 描述
----|---|---|---
`---` | `000` | `0` | 无权限
`--x` | `001` | `1` | 只要执行权限
`-w-` | `010` | `2` | 只有写入权限
`-wx` | `011` | `3` | 写入和执行权限
`r--` | `100` | `4` | 只有读取权限
`r-x` | `101` | `5` | 读取和执行权限
`rw-` | `110` | `6` | 读取和写入权限
`rwx` | `111` | `7` | 读取、写入和执行权限

`umask` 值是从对象完整权限集中减去的值。文件的完整权限是模式 `666` (所有人都读取/写入权限), 而目录的完整权限是 `777` (所有人都有读取/写入/执行权限)。  

`umask` 值通常设置在 `/etc/profile` 启动文件中。可以使用 `umask` 命令指定不同的默认 `umask` 设置。

    $ umask 026
    $ touch newfile2
    $ ls -l newfile2
    -rw-r----- 1 rich rich 0 Sep 20 19:46 newfile2
通过将 `umask` 值设置为 `026`, 默认文件权限将为 `640`, 因此, 新文件现在只允许用户组成员读取, 而系统上的其他人对该文件不具有任何权限。

由于目录的默认权限为 `777`, 因此通过 `umask` 生成的权限与新文件不同。`026` `umask` 值将从 `777` 中减去, 得出的目录权限设置为 `751`。

**`Tips : `** 这样看是有些麻烦且不易理解, 但就兼容性来看, 我们只是减去权限, 这样可以作用于权限值不同的单元而没有其他影响。

[返回目录](#toc)


#### [chown](id:chown) : 修改所有者 

`chown` 命令可以方便地修改文件的所有者。`chown` 命令的格式如下 : 

    chown options owner[.group] file
您可以为文件的新所有者指定登录名或数值 UID : 

    //修改文件用户为dan
    $ chown dan newfile
    
    //修改文件为rich用户组
    $ chown .rich newfile
    
    //修改文件用户及组
    $ chown dan.rich newfile
    
    //设置为与用户登录名相匹配的用户组名 test
    chown test. newfile
参数有 : `-R` 允许使用通配符对子目录和文件执行递归式修改。  
`-h` 参数还可以修改任何与文件具有符号关联的文件的所有者 :   
    只有根用户可以修改文件的所有者。任何用户都可以修改文件的默认用户组, 但用户必须是与修改操作相关的用户组中的成员。


[返回目录](#toc)


#### [chgrp](id:chgrp) : 修改用户默认组

`chgrp` 命令提供了一种简单的方法来仅修改文件或目录的默认用户组 :  

    $ chgrp shared newfile
    
[返回目录](#toc)

####  [共享文件](id:共享文件)
Linux 为每个文件和目录都存储了 3 个额外的信息位 : 

- `set user id (SUID)` : 当文件由用户执行时, 程序将在文件所有者的权限下运行。
- `set group id (SGID)` : 对于文件, 程序将在文件用户组的权限下运行。对于目录, 目录中创建的新文件使用目录用户组作为默认用户组。
- `粘着位` : 进程结束后, 文件仍然保留 (粘着) 在内存中。

        $ mkdir testdir     //创建目录
        $ chgrp shared testdir     //将目录添加到共享组
        $ chmod g+s testdir        //为目录设置 SGID,以确保在该目录中创建任何文件都使用共享用户组名称为默认用户组
        $ umask 002         //用户组成员权限设置为组内可读写执行
        $ cd testdir        //切换目录
        $ touch testfile    //创建共享文件

[返回目录](#toc)
