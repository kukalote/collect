# 生成和使用静态链接库

**静态库** 是 **obj 文件** 的一个集合，通常静态库以 “**.a**” 为后缀。静态库由程序 **ar** 生成，现在 **静态库** 已经不像之前那么普遍了，这主要是由于程序都在使用**动态库**。

**静态库** 的优点是可以在不用重新编译程序库代码的情况下，进行程序的重新链接，这种方法节省了编译过程的时间(在编译大型程序的时候，需要花费很长的时间)。但是由于现在系统的强大，编译的时间已经不是问题。**静态库** 的另一个优势是开发者可以提供库文件给使用的人员，不用开放源代码，这是库函数提供者经常采用的手段。在理论上，静态库的执行速度比共享库和动态库要快（1%~5%）。

1. **生成静态链接库**
生成静态库，或者将一个 **obj 文件** 加到已经存在的静态库的命令为 “**ar 库文件 obj 文件1 obj 文件2**”。例如将 string.o 打包为库文件 libstr.a 的命令为 :
```bash
$ ar -rcs libstr.a string.o
```
2. **使用静态链接库**
在编译程序的时候经常需要使用函数库，例如经常使用的 C 标准库等。GCC 链接时使用库函数和一般的 **obj 文件** 的形式是一致的，例如对 main.c 进行链接的时候，需要使用之前已经编译好的静态链接库 libstr.a，命令格式如下 :
```bash
$ gcc -o test main.c libstr.a
```
也可以使用命令 “**-l 库名**” 进行，库名是不包含函数库和扩展名的字符串。例如: 编译 main.c 链接静态库 libstr.a 的命令可以修改为 :
```bash
$ gcc -o test main.c -lstr
```
上面的命令将在系统默认的路径下查找 str 函数库，并把它链接到要生成的目标程序上。可能系统会提示无法找到库文件 str，这是由于 str 库函数没有在系统默认的查找路径下，需要显示指定库函数的路径，例如库文件和当前编译文件在同一目录下 :
```bash
$ gcc -o test main.c -L./ -lstr
```
注意 : 在使用 -l 选项时， -o 选项的目的名称要在 -l 链接的库名称之前，否则 gcc 会认为 -l 是生成的目标而出错。

